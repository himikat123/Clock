String fw = "3.2";
String vers = "BIM v" + fw;
int rssi = 0;
File fsUploadFile;
char text_buf[255] = "";

struct{
  char        ssid[40] = "";
  char        pass[40] = "";
  char        apssid[40] = "Clock";
  char        appass[40] = "1234567890";
  char        apip[16] = "192.168.4.1";
  char        apmask[16] = "255.255.255.0";
  uint8_t     chnl = 1;
  int8_t      utc = 0;
  uint8_t     daylight = 0;
  bool        time_format = false;
  uint8_t     day_bright = 0;
  uint8_t     day_bright2 = 0;
  uint8_t     night_bright = 0;
  uint8_t     night_bright2 = 0;
  bool        type = 0;
  char        ip[16] = "";
  char        mask[16] = "";
  char        gw[16] = "";
  char        dns1[16] = "";
  char        dns2[16] = "";
  int         hd = 0;
  int         hd2 = 0;
  int         md = 0;
  int         md2 = 0;
  int         hn = 0;
  int         hn2 = 0;
  int         mn = 0;
  int         mn2 = 0;
  char        ntp[40] = "time.nist.gov";
  uint32_t    chid = 0;
  uint8_t     disp = 1;
  uint8_t     disp2 = 2;
  uint32_t    ntp_period = 300;
  uint8_t     tupd = 5;
  bool        thngsend = false;
  bool        thngrcv = false;
  uint8_t     tf1 = 0;
  uint8_t     tf2 = 0;
  uint8_t     tf3 = 0;
  uint8_t     tf4 = 0;
  uint8_t     tf5 = 0;
  uint8_t     tf6 = 0;
  uint8_t     tf7 = 0;
  uint8_t     tf8 = 0;
  char        rdkey[40] = "";
  char        wrkey[40] = "";
  uint8_t     dp[6] = {6, 2, 0, 0, 0, 0};
  uint8_t     d2p[6] = {6, 2, 0, 0, 0, 0};
  uint8_t     dt[6] = {1, 1, 1, 1, 1, 1};
  uint8_t     d2t[6] = {1, 1, 1, 1, 1, 1};
  char        dc[6][5] = {"#FFF", "#FFF", "#FFF", "#FFF", "#FFF", "#FFF"};
  char        d2c[6][5] = {"#FFF", "#FFF", "#FFF", "#FFF", "#FFF", "#FFF"};
  char        ds[6][4] = {"C", "C", "C", "C", "C", "C"};
  char        d2s[6][4] = {"C", "C", "C", "C", "C", "C"};
  char        username[40] = "admin";
  char        password[40] = "1111";
  uint8_t     provider = 0;
  uint8_t     citysearch = 0;
  char        city[40] = "";
  char        lat[32] = "";
  char        lon[32] = "";
  char        cityid[12] = "";
  char        appid[40] = "";
  char        appkey[40] = "";
  uint8_t     bme_plc = 0;
  uint8_t     bmp_plc = 0;
  uint8_t     sht_plc = 0;
  uint8_t     dht_plc = 0;
  uint8_t     ds18_plc = 0;
  uint8_t     ds32_plc = 0;
  uint8_t     ths_plc = 0;
  uint8_t     wet_plc = 0;
  uint8_t     bme_plc2 = 0;
  uint8_t     bmp_plc2 = 0;
  uint8_t     sht_plc2 = 0;
  uint8_t     dht_plc2 = 0;
  uint8_t     ds18_plc2 = 0;
  uint8_t     ds32_plc2 = 0;
  uint8_t     ths_plc2 = 0;
  uint8_t     wet_plc2 = 0;
} config;

struct{
  int8_t clock_dig[2][8] = {{0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10}, {0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10}};
  int8_t clock_points[2][8] = {{0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}};
  bool dots = true;
  bool dots2 = true;
  bool halb = false;
  bool weather_upd = true;
  bool thing_upd = true;
  bool thing_snd = true;
  uint8_t prev_sec = 60;
  bool clock_synchronized = false;
  time_t prev_millis = 0;
  time_t prev_millis2 = 0;
  uint8_t snum = 5;
  uint8_t snum2 = 5;
  float temp_web = 404.0;
  float hum_web = 202.0;
  float pres_web = 4040.0;
  float thing[9] = {4040.0, 4040.0, 4040.0, 4040.0, 4040.0, 4040.0, 4040.0, 4040.0, 4040.0};
  time_t thing_tm = 0;
  time_t wet_tm = 0;
  bool is_day = true;
  bool is_day2 = true;
//  bool ap_mode = false;
  bool ip_mode = false;
  uint8_t ip_cnt = 0;
} datas;

struct{
  bool bme280_det = false;
  bool bmp180_det = false;
  bool sht21_det = false;
  bool dht22_det = false;
  uint8_t ds18_det = 0;
  bool ds32_det = false;
  float bme280_temp = 404.0;
  float bme280_temp_corr = 0.0;
  float bme280_hum = 202.0;
  float bme280_hum_corr = 0.0;
  float bme280_pres = 4040.0;
  float bme280_pres_corr = 0.0;
  float bmp180_temp = 404.0;
  float bmp180_temp_corr = 0.0;
  float bmp180_pres = 4040.0;
  float bmp180_pres_corr = 0.0;
  float sht21_temp = 404.0;
  float sht21_temp_corr = 0.0;
  float sht21_hum = 202.0;
  float sht21_hum_corr = 0.0;
  float dht22_temp = 404.0;
  float dht22_temp_corr = 0.0;
  float dht22_hum = 202.0;
  float dht22_hum_corr = 0.0;
  float ds18_temp = 404.0;
  float ds18_temp_corr = 0.0;
  float ds32_temp = 404.0;
  float ds32_temp_corr = 0.0;
} sensors;

void half(void);
void w_upd(void);
void t_upd(void);
void t_snd(void);
void data_prep(void);
void tm1637_fill(uint8_t type, uint8_t disp);
void max7219_fill(uint8_t type1, uint8_t type2);
void display_fill(void);
bool get_clock(bool dots, uint8_t displ);
bool get_date(uint8_t displ);
bool get_temp(float temperature, uint8_t displ);
bool get_hum(float humidity, uint8_t displ);
bool get_pres(float pressure, uint8_t displ);
void read_eeprom(void);
void connectToWiFi(void);
void sensors_init(void);
void sensors_read(void);
//String httpData = "";
void getWeatherNow(void);
String weatherRequest(String url);
void parseWeatherNow(String httpData);
void thingspk_recv(void);
String thingRequest(String url);
void parseThing(String httpData);
void thingspk_send(void);
String getContentType(String filename);
bool handleFileRead(String path);
bool FileRead(String path);
void handleFileUpload(void);
void web_settings(void);
